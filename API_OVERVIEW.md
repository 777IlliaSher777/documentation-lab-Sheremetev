# API Overview  
Коротка технічна документація для демонстраційних **REST API** ендпоінтів **HelpDeskPro**.  
Наведені приклади — умовні, їх можна адаптувати під реальну реалізацію.  

## Загальні відомості  
- **Base URL:** `http://localhost:4000`
- **Формат:** JSON
- **Аутентифікація:** **Bearer** токен у заголовку `Authorization: Bearer <token>`
- **Заголовки:**
```
Content-Type: application/json
Authorization: Bearer <token>
```

## GET /tickets  
**Опис**: Повертає список тикетів користувача або всі тикети для агентів/адмінів. Підтримує пагінацію та фільтри.  
**Параметри запиту (query)**  
- `page` — номер сторінки (за замовчуванням 1)  
- `limit` — кількість елементів на сторінку (за замовчуванням 10)  
- `status` — фільтр за статусом (`open`, `in_progress`, `resolved`, `closed`)  
- `priority` — фільтр за пріоритетом (`low`, `medium`, `high`)

**Приклад запиту (curl)**
```
  curl "http://localhost:4000/tickets?page=1&limit=10&status=open" \
  -H "Authorization: Bearer eyJ..."
```
**Приклад відповіді (200)**  
```
{
  "page": 1,
  "limit": 10,
  "total": 2,
  "tickets": [
    {
      "id": "tkt_101",
      "subject": "Не працює вхід",
      "status": "open",
      "priority": "high",
      "createdAt": "2025-04-01T10:00:00Z",
      "requester": "user@example.com"
    },
    {
      "id": "tkt_102",
      "subject": "Проблема з оплатою",
      "status": "in_progress",
      "priority": "medium",
      "createdAt": "2025-04-02T12:30:00Z",
      "requester": "client@example.com"
    }
  ]
}
```
**Коди помилок**  
- `200` — успішно.  
- `400` — некоректні параметри запиту.  
- `401` — неавторизований.  
- `403` — доступ заборонено (недостатні права).  
- `500` — внутрішня помилка сервера.

## POST /tickets  
**Опис**: Створює новий тикет від імені користувача.  
**Тіло запиту (JSON)**  
```
{
  "subject": "Не надходять сповіщення",
  "description": "Не приходять email сповіщення при зміні статусу тикета. Перевірив папку спаму.",
  "category": "Notifications",
  "priority": "low",
  "attachments": []
}
```
**Приклад запиту (curl)**  
```
curl -X POST http://localhost:4000/tickets \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer eyJ..." \
  -d '{"subject":"Не надходять сповіщення","description":"...","category":"Notifications","priority":"low"}'
```
**Приклад відповіді (201)**  
```
{
  "id": "tkt_103",
  "subject": "Не надходять сповіщення",
  "status": "open",
  "priority": "low",
  "createdAt": "2025-04-10T09:15:00Z",
  "requester": "user@example.com"
}
```
**Коди помилок**  
- `201` — створено.  
- `400` — некоректні або відсутні обов'язкові поля (наприклад, відсутній subject).  
- `401` — неавторизований.  
- `413` — вкладення занадто велике.  
- `500` — внутрішня помилка сервера.

## GET /tickets/{id}  
**Опис**: Повертає деталі конкретного тикета, включно з історією коментарів і вкладеннями.  
**Параметри шляху**  
- `id` — ідентифікатор тикета (наприклад, `tkt_103`)

**Приклад запиту (curl)**  
```
  curl http://localhost:4000/tickets/tkt_103 \
  -H "Authorization: Bearer eyJ..."
```
**Приклад відповіді (200)**  
```
{
  "id": "tkt_103",
  "subject": "Не надходять сповіщення",
  "description": "Не приходять email сповіщення при зміні статусу тикета.",
  "status": "open",
  "priority": "low",
  "requester": "user@example.com",
  "assignee": null,
  "comments": [
    {
      "author": "user@example.com",
      "message": "Додаткові деталі: перевірив спам.",
      "createdAt": "2025-04-10T09:20:00Z"
    }
  ],
  "attachments": []
}
```
**Коди помилок**  
- `200` — успішно.  
- `401` — неавторизований.  
- `403` — доступ заборонено.  
- `404` — тикет не знайдено.  
- `500` — внутрішня помилка сервера.

## PUT /tickets/{id}  
**Опис**: Оновлює дані існуючого тикета: статус, пріоритет, виконавця або інші поля.  
**Параметри шляху**  
- `id` — ідентифікатор тикета (наприклад, `tkt_103`).

**Тіло запиту (JSON)**
```
{
  "status": "in_progress",
  "priority": "high",
  "assignee": "agent_42",
  "subject": "Оновлена тема (опціонально)",
  "description": "Додаткові деталі (опціонально)"
}
```
**Приклад запиту (curl)**  
```
curl -X PUT http://localhost:4000/tickets/tkt_103 \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <token>" \
  -d '{
    "status":"in_progress",
    "priority":"high",
    "assignee":"agent_42"
  }'
```
**Приклад відповіді (200)**  
```
{
  "id": "tkt_103",
  "subject": "Не надходять сповіщення",
  "status": "in_progress",
  "priority": "high",
  "assignee": "agent_42",
  "updatedAt": "2025-04-10T10:05:00Z"
}
```
**Коди помилок**  
- `200` — успішно оновлено.  
- `400` — некоректні дані (наприклад, невірний формат поля).  
- `401` — неавторизований.  
- `403` — доступ заборонено (недостатньо прав для зміни).  
- `404` — тикет з вказаним id не знайдено.  
- `409` — конфлікт (наприклад, паралельне оновлення).  
- `500` — внутрішня помилка сервера.

## POST /tickets/{id}/comments  
**Опис**: Додає коментар до тикета. Використовується як користувачами, так і агентами для обміну повідомленнями в рамках тикета.  
**Параметри шляху**  
- `id` — ідентифікатор тикета (наприклад, `tkt_103`).

**Тіло запиту (JSON)**
```
{
  "message": "Додаткові деталі: перевірив спам, додаю лог у вкладенні.",
  "private": false
}
```
- `message` — текст коментаря (обов'язково).
- `private` — прапорець, чи видимий коментар лише агентам (`true`) або всім учасникам тикета (`false`).

**Приклад запиту (curl)**
```
curl -X POST http://localhost:4000/tickets/tkt_103/comments \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <token>" \
  -d '{
    "message":"Додаткові деталі: перевірив спам, додаю лог у вкладенні.",
    "private": false
  }'
```
**Приклад відповіді (201)**  
```
{
  "commentId": "cmt_789",
  "ticketId": "tkt_103",
  "author": "user@example.com",
  "message": "Додаткові деталі: перевірив спам, додаю лог у вкладенні.",
  "private": false,
  "createdAt": "2025-04-10T09:20:00Z"
}
```
**Коди помилок**  
- `201` — коментар створено.  
- `400` — некоректні дані (наприклад, порожнє повідомлення).  
- `401` — неавторизований.  
- `403` — доступ заборонено (наприклад, спроба додати приватний коментар без прав).  
- `404` — тикет не знайдено.  
- `413` — вкладення занадто велике (якщо підтримується завантаження файлів).  
- `500` — внутрішня помилка сервера.   

## Додаткові примітки  
- **Формат дат** — ISO 8601 у UTC (наприклад, `2025-04-10T09:15:00Z`).  
- **Пагінація** — повертайте `total` для клієнта, щоб він міг обчислити кількість сторінок.  
- **Валідація** — перевіряйте обов’язкові поля (`subject`, `description` для **POST**) і повертайте зрозумілі повідомлення помилок у тілі відповіді.  
- **Аутентифікація** — при відсутності або некоректному токені повертайте `401` з повідомленням `{"error":"Unauthorized"}`.

**Приклад відповіді з помилкою (JSON)**  
```
{
  "error": "ValidationError",
  "message": "Subject is required"
}
```
